<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 8.3 - Native APIs Demo</title>
<style>
/* styles à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸„à¸¸à¸“à¹€à¸‚à¸µà¸¢à¸™à¹„à¸§à¹‰à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰ */
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0;padding:20px;background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:white;}
.container{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.1);padding:30px;border-radius:15px;backdrop-filter:blur(10px);}
.section{background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;margin-bottom:20px;}
.button{background:rgba(255,255,255,0.2);border:2px solid white;color:white;padding:12px 24px;border-radius:25px;cursor:pointer;font-size:16px;margin:10px 5px;transition:all 0.3s ease;}
.button:hover{background:white;color:#4CAF50;transform:translateY(-2px);}
.result-box{background:rgba(0,0,0,0.2);padding:15px;border-radius:8px;margin-top:15px;font-family:monospace;white-space:pre-wrap;max-height:200px;overflow-y:auto;}
.file-content{background:rgba(255,255,255,0.9);color:#333;padding:15px;border-radius:8px;margin-top:15px;max-height:300px;overflow-y:auto;font-family:monospace;}
textarea{width:100%;height:150px;padding:10px;border:none;border-radius:5px;font-family:monospace;font-size:14px;resize:vertical;box-sizing:border-box;}
.loading{color:#FFD700;}
.success{color:#90EE90;}
.error{color:#FF6B6B;}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>ğŸ–¥ï¸ Native APIs Demo</h1><p>à¸à¸²à¸£à¹ƒà¸Šà¹‰ Native APIs à¸‚à¸­à¸‡ Operating System</p></div>

  <!-- File Operations Section -->
  <div class="section">
    <h3>ğŸ“ File Operations</h3>
    <button class="button" onclick="openFile()">ğŸ“‚ à¹€à¸›à¸´à¸”à¹„à¸Ÿà¸¥à¹Œ</button>
    <button class="button" onclick="exportAgentData()">ğŸ“Š Export Agent Data</button>
    <button class="button" onclick="saveCurrentContent()">ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸™à¸·à¹‰à¸­à¸«à¸²</button>
    <div class="result-box" id="fileResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸š file operations</div>
    <div id="fileContent" class="file-content" style="display:none;"></div>
  </div>

  <!-- Text Editor Section -->
  <div class="section">
    <h3>ğŸ“ Text Editor</h3>
    <textarea id="textEditor"># Agent Report
à¸§à¸±à¸™à¸—à¸µà¹ˆ: ${new Date().toLocaleDateString('th-TH')}
## à¸ªà¸£à¸¸à¸›à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Agents
- Agent ID: AG001
- à¸Šà¸·à¹ˆà¸­: Alice Johnson
- à¸ªà¸–à¸²à¸™à¸°: Available
- à¸ˆà¸³à¸™à¸§à¸™à¸ªà¸²à¸¢: 15 calls
- à¹€à¸§à¸¥à¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢: 245 à¸§à¸´à¸™à¸²à¸—à¸µ
## à¸ªà¸–à¸´à¸•à¸´à¸§à¸±à¸™à¸™à¸µà¹‰
- Total Calls: 35
- Avg Wait Time: 45 à¸§à¸´à¸™à¸²à¸—à¸µ
- Available Agents: 1 à¸„à¸™
- Busy Agents: 1 à¸„à¸™</textarea>
  </div>

  <!-- Notifications Section -->
  <div class="section">
    <h3>ğŸ”” Desktop Notifications</h3>
    <button class="button" onclick="testBasicNotification()">ğŸ”” à¸—à¸”à¸ªà¸­à¸š Notification</button>
    <button class="button" onclick="testAgentLogin()">ğŸŸ¢ Agent Login</button>
    <button class="button" onclick="testCallReceived()">ğŸ“ Call Received</button>
    <button class="button" onclick="testUrgentAlert()">ğŸš¨ Urgent Alert</button>
    <div class="result-box" id="notificationResult">à¸à¸”à¸›à¸¸à¹ˆà¸¡à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸š notifications</div>
  </div>

  <!-- System Tray Section -->
  <div class="section">
    <h3>ğŸ–±ï¸ System Tray Integration</h3>
    <button class="button" onclick="testHideToTray()">ğŸ‘ï¸ à¸‹à¹ˆà¸­à¸™à¹„à¸› Tray</button>
    <button class="button" onclick="testTrayNotification()">ğŸ”” à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸ˆà¸²à¸ Tray</button>
    <div class="result-box" id="trayResult">
â„¹ï¸ System Tray Features:
â€¢ à¸„à¸¥à¸´à¸à¸‚à¸§à¸²à¸—à¸µà¹ˆ icon à¹ƒà¸™ taskbar à¹€à¸à¸·à¹ˆà¸­à¹€à¸›à¸´à¸”à¹€à¸¡à¸™à¸¹
â€¢ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸° agent à¹„à¸”à¹‰à¸ˆà¸²à¸ tray menu
â€¢ à¸‹à¹ˆà¸­à¸™/à¹à¸ªà¸”à¸‡ app à¹„à¸”à¹‰à¸ˆà¸²à¸ tray
â€¢ à¸›à¸´à¸”à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¹„à¸”à¹‰à¸ˆà¸²à¸ tray menu
ğŸ’¡ à¸¥à¸­à¸‡à¸›à¸´à¸” window à¸™à¸µà¹‰ - à¹à¸­à¸›à¸ˆà¸°à¸‹à¹ˆà¸­à¸™à¹„à¸›à¹ƒà¸™ system tray!
    </div>
  </div>
</div>

<script>
// ====================== RENDERER JS ======================
function showResult(elementId, message, type='info') {
  const element = document.getElementById(elementId);
  const timestamp = new Date().toLocaleTimeString('th-TH');
  element.innerHTML = `[${timestamp}] ${message}`;
  element.className = `result-box ${type}`;
}

// --- File Operations ---
async function openFile() {
  showResult('fileResult','à¸à¸³à¸¥à¸±à¸‡à¹€à¸›à¸´à¸” file dialog...','loading');
  const result = await window.nativeAPI.openFile();
  if(result.success){
    showResult('fileResult',`âœ… à¹€à¸›à¸´à¸”à¹„à¸Ÿà¸¥à¹Œà¸ªà¸³à¹€à¸£à¹‡à¸ˆ!\nà¸Šà¸·à¹ˆà¸­: ${result.fileName}\nà¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ: ${result.filePath}\nà¸‚à¸™à¸²à¸”: ${result.size} characters`,'success');
    const contentDiv = document.getElementById('fileContent');
    contentDiv.style.display='block';
    contentDiv.innerHTML=`ğŸ“„ à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹„à¸Ÿà¸¥à¹Œ ${result.fileName}:\n\n${result.content}`;
    document.getElementById('textEditor').value=result.content;
  } else if(result.cancelled){ showResult('fileResult','â¹ï¸ à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¹€à¸›à¸´à¸”à¹„à¸Ÿà¸¥à¹Œ','info'); }
}

async function saveCurrentContent() {
  const content = document.getElementById('textEditor').value;
  if(!content.trim()){ showResult('fileResult','âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸«à¹‰à¸šà¸±à¸™à¸—à¸¶à¸','error'); return; }
  const result = await window.nativeAPI.saveFile(content, `my-document-${Date.now()}.txt`);
  if(result.success){
    showResult('fileResult',`ğŸ’¾ à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!\nà¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œ: ${result.fileName}\nà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡: ${result.filePath}\nà¸‚à¸™à¸²à¸”: ${content.length} chars`,'success');
  }
}

// --- Agent Export ---
async function exportAgentData(){
  const agentData=['Agent ID,Name,Status,Extension,Department,Total Calls,Avg Call Time',
                   'AG001,Alice Johnson,Available,1001,Sales,15,245',
                   'AG002,Bob Smith,Busy,1002,Support,8,312',
                   'AG003,Carol Lee,Break,1003,Sales,12,198'].join('\n');
  const result = await window.nativeAPI.saveFile(agentData, `agent-report-${new Date().toISOString().split('T')[0]}.csv`);
  if(result.success) showResult('fileResult',`ğŸ“Š à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!\nà¸Šà¸·à¹ˆà¸­à¹„à¸Ÿà¸¥à¹Œ: ${result.fileName}\nà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡: ${result.filePath}`,'success');
}

// --- Notifications ---
async function testBasicNotification(){await window.nativeAPI.showNotification('Agent Wallboard','à¸™à¸µà¹ˆà¸„à¸·à¸­ desktop notification à¸—à¸”à¸ªà¸­à¸š! ğŸ‰'); showResult('notificationResult','âœ… à¹à¸ªà¸”à¸‡ notification à¸ªà¸³à¹€à¸£à¹‡à¸ˆ','success');}
async function testAgentLogin(){await window.nativeAPI.notifyAgentEvent('Alice Johnson','login'); showResult('notificationResult','ğŸŸ¢ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™ Agent Login à¸ªà¸³à¹€à¸£à¹‡à¸ˆ','success');}
async function testCallReceived(){await window.nativeAPI.notifyAgentEvent('Bob Smith','call_received'); showResult('notificationResult','ğŸ“ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸ªà¸²à¸¢à¹€à¸‚à¹‰à¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ','success');}
async function testUrgentAlert(){await window.nativeAPI.showNotification('ğŸš¨ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸”à¹ˆà¸§à¸™!','à¸£à¸°à¸šà¸šà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸¡à¸µà¸›à¸±à¸à¸«à¸² à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸”à¹ˆà¸§à¸™!',true); showResult('notificationResult','ğŸš¨ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸”à¹ˆà¸§à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ','success');}

// --- System Tray ---
function testHideToTray(){showResult('trayResult','ğŸ‘ï¸ à¸‹à¹ˆà¸­à¸™à¹„à¸› tray...','loading'); window.nativeAPI.hideToTray();}
function testTrayNotification(){showResult('trayResult','âœ… à¸—à¸”à¸ªà¸­à¸š System Tray à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!','success');}
window.nativeAPI.onStatusChangedFromTray((data)=>{
  showResult('trayResult',`ğŸ”„ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸–à¸²à¸™à¸°à¸ˆà¸²à¸ Tray\nà¸ªà¸–à¸²à¸™à¸°à¹ƒà¸«à¸¡à¹ˆ: ${data.newStatus}\nà¹€à¸§à¸¥à¸²: ${new Date(data.timestamp).toLocaleString('th-TH')}`,'success');
});
</script>
</body>
</html>
